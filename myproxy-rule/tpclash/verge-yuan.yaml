tproxy-port: 7893
mixed-port: 7890 # 局域网访问Port
bind-address: "*" #绑定IP地址
allow-lan: true # 允许局域网访问
mode: rule # 模式
log-level: info # 日志等级
external-controller: 0.0.0.0:9090 # 网页端口
find-process-mode: strict # 匹配所有进程
tcp-concurrent: true # tcp 并发模式
ipv6: false #软路由上不建议开启

# clash meta 内核需要关闭 iptables
iptables:
  enable: false

# 域名嗅探，关闭

geodata-mode: true
geox-url: # 自定义 geodata url, 需要有代理的前提才能下载geoip和geosite
  geoip: "https://gcore.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://gcore.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://gcore.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"

# fakeip 本地存储，省略DNS查询
profile:
  store-selected: true # 存储 select 选择记录
  store-fake-ip: true # 持久化 fake-ip

# tun:
#   enable: true
#   stack: system # gvisor / lwip
#   dns-hijack:
#     - any:53 # 需要劫持的 DNS
#   auto-route: true # 自动设置全局路由，可以自动将全局流量路由进入tun网卡。
#   auto-detect-interface: true # 自动识别出口网卡

dns:
  enable: true # 关闭将使用系统 DNS
  prefer-h3: true # 开启 DoH 支持 HTTP/3，将并发尝试
  listen: 0.0.0.0:1053 # 开启 DNS 服务器监听
  ipv6: false # 如果需要ipv6设置为true
  default-nameserver:
    # - 192.168.6.1 fakeip 模式不使用内网地址作为 dns
    # defautl dns 需要是纯 IP
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter: #这里可以填写不使用fakeip的域名
    - "*.jd.com"

  nameserver:
    # - 192.168.6.1 fakeip 模式不使用内网地址作为 dns
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
    - https://doh.pub/dns-query
  fallback:
    - https://1.0.0.1/dns-query
    - tls://dns.google

# 策略组引用

pr: &a1 { type: select, proxies: ["Auto"], use: [yuan, hneko] }

auto: &a2 { type: url-test, use: [hneko, yuan], url: "http://www.gstatic.com/generate_204", interval: 300 }

pr1: &a3 { type: select, proxies: ["PROXY", "DIRECT"], use: [hneko, yuan] }

# for openai
pr2: &a4 { type: select, proxies: ["PROXY"], use: [beta, hneko, yuan] }

# anchor for proxy provider
prp: &prp { type: http, interval: 86400, health-check: { enable: true, interval: 300, url: "http://www.gstatic.com/generate_204" } }

rl1: &rl1 { type: http, interval: 86400, behavior: classical }

rl2: &rl2 { type: http, interval: 86400, behavior: domain }

rl3: &rl3 { type: http, interval: 86400, behavior: ipcidr }

#代理集  如果是自建节点屏蔽这里
proxy-providers:
  #自定义名称
  hneko: { url: "https://oo.hnekoo.top/api/v1/client/subscribe?token=b82e133f8ff80f8b1053978f89353da9", path: "./profiles/hneko.yaml", <<: *prp }

  beta: { url: "https://v2sub.betac1ouds.top/modules/servers/V2raySocks/NEWclash.php?sid=7197&token=zj72yNuIbqCx", path: "./profiles/beta.yaml", <<: *prp }

  yuan: { url: "https://sub2.smallstrawberry.com/api/v1/client/subscribe?token=e8e6c2e45cf9c1f273a37379c979586a", path: "./profiles/yuan.yaml", <<: *prp }

proxy-groups:
  - { name: "Auto", <<: *a2 }
  - { name: "PROXY", <<: *a1 }
  - { name: "youtube", <<: *a3 }
  - { name: "telegram", <<: *a3 }
  - { name: "apple", <<: *a3 }
  - { name: "microsoft", <<: *a3 }
  - { name: "openai", <<: *a4 }
  - { name: "emby", <<: *a3 }
  - { name: "spotify", <<: *a3 }
  - { name: "gscholar", <<: *a3 }
  - { name: "google", <<: *a3 }
  - { name: "github", <<: *a3 }
  - { name: "bilius", <<: *a3 }
  - { name: "onedrive", <<: *a3 }
  - { name: "stream", <<: *a3 }
  - { name: "icloud", <<: *a3 }

rule-providers:
  mdirect:
    { path: "./ruleset/mdirect.yaml", url: "https://gist.githubusercontent.com/zwyyy456/4811d18198c3ad49d0485480eff22d9f/raw/direct-rule.yaml", <<: *rl1 }
  mdirect-ip:
    { path: "./ruleset/mdirect-ip.yaml", url: "https://gist.githubusercontent.com/zwyyy456/5e30e860689f18f0c05c5d42bdcd72d5/raw/direct-ip-rule.yaml", <<: *rl3 }

  mproxy: { path: "./ruleset/mproxy.yaml", url: "https://gist.githubusercontent.com/zwyyy456/43afd8f49c179fddbfa54458e898eb2e/raw/proxy-rule.yaml", <<: *rl1 }

  openai: { url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml", path: "./ruleset/openai.yaml", <<: *rl1 }

  reject: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt", path: "./ruleset/reject.yaml", <<: *rl2 }

  icloud: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt", path: "./ruleset/icloud.yaml", <<: *rl2 }

  apple-direct: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt", path: "./ruleset/apple-direct.yaml", <<: *rl2 }

  google-direct: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt", path: "./ruleset/google-direct.yaml", <<: *rl2 }

  proxy: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt", path: "./ruleset/proxy.yaml", <<: *rl2 }

  direct: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt", path: "./ruleset/direct.yaml", <<: *rl2 }

  private: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt", path: "./ruleset/private.yaml", <<: *rl2 }

  gfw: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt", path: "./ruleset/gfw.yaml", <<: *rl2 }

  tld-not-cn: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt", path: "./ruleset/tld-not-cn.yaml", <<: *rl2 }

  telegramcidr: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt", path: "./ruleset/telegramcidr.yaml", <<: *rl3 }

  cncidr: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt", path: "./ruleset/cncidr.yaml", <<: *rl3 }

  lancidr: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt", path: "./ruleset/lancidr.yaml", <<: *rl3 }

  applications: { url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt", path: "./ruleset/applications.yaml", <<: *rl1 }

rules:
  # 开始匹配规则
  - RULE-SET,direct,DIRECT
  - RULE-SET,cncidr,DIRECT,no-resolve
  - RULE-SET,private,DIRECT
  - RULE-SET,mdirect,DIRECT
  - RULE-SET,midirect-ip,DIRECT
  - RULE-SET,apple-direct,DIRECT
  - RULE-SET,lancidr,DIRECT,no-resolve
  - RULE-SET,applications,DIRECT

  - RULE-SET,mproxy,PROXY

  ## GEOSITE
  - GEOSITE,bilibili,DIRECT
  - GEOSITE,icloud,icloud
  - GEOSITE,apple,apple
  - GEOSITE,onedrive,onedrive
  - GEOSITE,spotify,spotify
  - GEOSITE,youtube,youtube
  - GEOSITE,netflix,stream
  - GEOSITE,google,google
  - GEOSITE,telegram,telegram
  - GEOSITE,github,github
  - GEOSITE,microsoft,microsoft
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,openai,openai
  - GEOSITE,category-games@cn,DIRECT
  - GEOSITE,geolocation-!cn,PROXY
  - GEOSITE,cn,DIRECT

  - RULE-SET,telegramcidr,telegram,no-resolve
  - RULE-SET,gfw,PROXY

  # 是否有这样的请求，域名不在上述规则之内，但是 ip 又是国内的？目前看来，似乎没有碰到过这样的情况；故选择 GEOIP,CN,DIRECT,no-resolve
  - GEOIP,cn,DIRECT,no-resolve

  - MATCH,PROXY
